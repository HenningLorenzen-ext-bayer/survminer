# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.


## Standard Workflow

1. **First think through the problem, read the codebase for relevant files, and write a plan to tasks/todo.md.**

2. **The plan should have a list of todo items that you can check off as you complete them**

3. **Before you begin working, check in with me and I will verify the plan.**

4. **Then, begin working on the todo items, marking them as complete as you go.**

5. **Please every step of the way just give me a high level explanation of what changes you made**

6. **Make every task and code change you do as simple as possible. We want to avoid making any massive or complex changes. Every change should impact as little code as possible. Everything is about simplicity.**

7. **Finally, add a review section to the todo.md file with a summary of the changes you made and any other relevant information.**


## Overview

survminer is an R package for survival analysis and visualization built on ggplot2. It provides functions for drawing publication-ready survival curves with risk tables and diagnostic plots for Cox proportional hazards models.

## Development Commands


### Load and test during the development

```bash
Rscript -e "devtools::load_all()"
Rscript -e "devtools::document()"
Rscript -e "devtools::test()"
```


### Package Checking

```bash
Rscript -e "devtools::check()"
Rscript -e "urlchecker::url_check()"
```

### Install

```bash
Rscript -e "devtools::install()"
```


## Commit and pull request text strategy

- neither add the following in commit message or pull request text:
  
```
Generated with [Claude Code](https://claude.ai/code)                                                                                
Co-Authored-By: Claude <noreply@anthropic.com>"
```
-  don't use emojis like üìù, üì¢, etc



## Package Architecture

### Core Components

The package is organized into several functional areas:

**Main Plotting Functions** (`R/ggsurvplot*.R`):
- `ggsurvplot_core.R`: Core survival curve plotting engine
- `ggsurvplot.R`: Main user-facing function with multiple dispatch
- `ggsurvplot_df.R`: Plot from data frame summaries
- `ggsurvplot_list.R`: Handle lists of survfit objects
- `ggsurvplot_facet.R`: Multi-panel faceted plots
- `ggsurvplot_group_by.R`: Group-wise plotting
- `ggsurvplot_combine.R`: Combine multiple survival curves

**Cox Model Diagnostics** (`R/ggcox*.R`):
- `ggcoxdiagnostics.R`: Model fit diagnostics
- `ggcoxfunctional.R`: Functional form assessment
- `ggcoxzph.R`: Proportional hazards testing
- `ggforest.R`: Forest plots for hazard ratios

**Utility Functions**:
- `utilities.R`: Core helper functions and imports
- `surv_summary.R`: Create tidy survival summaries
- `surv_pvalue.R`: Calculate log-rank test p-values
- `ggsurvtable.R`: Risk tables and event tables

### Dependencies

Built on tidyverse ecosystem with key dependencies:
- `ggplot2` (‚â•3.4.0): Core plotting
- `ggpubr` (‚â•0.1.6): Publication-ready themes
- `survival`: Survival analysis functions
- `dplyr`, `tidyr`, `purrr`: Data manipulation
- `ggtext`: Enhanced text formatting

### Testing Structure

Tests use `testthat` framework located in `tests/testthat/`:
- Test files follow `test-[function].R` naming convention
- `setup-load_data.R`: Common test data setup
- Main test entry point: `tests/testthat.R`

### Documentation

- Function documentation: `man/*.Rd` (auto-generated by roxygen2)
- Vignettes: `vignettes/*.Rmd` with detailed examples
- Package website: Built with pkgdown using `_pkgdown.yml` configuration
- Cheatsheet: `pkgdown/cheatsheet/survminer_cheatsheet.pdf`

## Key Design Patterns

1. **Function Hierarchy**: `ggsurvplot()` acts as dispatcher to specialized `ggsurvplot_*()` functions
2. **S3 Methods**: Uses S3 dispatch for print methods and plotting
3. **ggplot2 Integration**: Returns ggplot objects that can be further customized
4. **Modular Components**: Survival plots, risk tables, and censor plots are separate components that can be combined
5. **Data Pipeline**: `survfit` ‚Üí `surv_summary()` ‚Üí `ggsurvplot_df()` for custom workflows